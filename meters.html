<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-styles/default-theme.html">
<link rel="import" href="../paper-styles/typography.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<dom-module id="radial-meter">
  <!-- content  -->
  <template>
    <style>
      #container {
        width: 200px;
        height: 200px;
        font-family: 'Roboto', 'Noto', sans-serif;
        position: relative;
      }
      #radial-container {
        width: inherit;
        height: inherit;
        fill: none;
        position: absolute;
        left: 0px;
        top: 10px;
      }
      #radial-meter-bar {
        stroke: var(--radial-meter-active-color, --default-primary-color);
        transition: all var(--radial-meter-transition-duration, 1s);
      }
      #radial-placeholder-bar {
        stroke: var(--radial-meter-inactive-color, --divider-color);
      }
      #data-container {;
        text-align: center;
        height: inherit;
        width: inherit;
        position: absolute;
        top: 0px;
        left: 0px;
      }
      #data-value {
        font-size: 4em;
        display: block;
        padding-top: 33%;
      }
      #data-metric {
        font-size: .2em;
        text-align: right;
        vertical-align: 2.6em;
      }
    </style>
    <div id="container">
      <div id="radial-container">
        <svg version="1.1" width="100%" height="100%">
          <circle id="radial-placeholder-bar"
                  cx="100" cy="100" r="92"
                  transform="rotate(135 100 100)"
                  stroke-dashoffset="144"
                  stroke-dasharray="578 578"
                  stroke-width="8"/>
          <circle id="radial-meter-bar"
                  cx="100" cy="100" r="92"
                  transform="rotate(135 100 100)"
                  stroke-dashoffset="578"
                  stroke-dasharray="578 578"
                  stroke-width="8"/>
        </svg>
      </div>
      <div id="data-container">
        <span id="data-value">[[data]]<span id="data-metric">[[metric]]</span></span>
      </div>
    </div>
  </template>
  <!-- logic -->
  <script>
    Polymer({
      is: 'radial-meter',

      properties: {
        max: {
          type: Number,
          value: 100,
          observer: '_baseChanged'
        },
        min: {
          type: Number,
          value: 0,
          observer: '_baseChanged'
        },
        data: {
          type: Number,
          observer: '_dataChanged'
        },
        metric: String
      },

      _dataChanged: function(newValue, oldValue) {
        var convertedValue = newValue / (this.max - this.min);
        var val =  this.radians - (this.radians - (90 * this.multiplier)) * (convertedValue);

        if (isNaN(val)) {
          return;
        }

        this.$$('#radial-meter-bar').setAttribute('stroke-dashoffset', val);
      },

      _baseChanged: function(newValue, oldValue) {
        this.calcBaseMetrics();
        _dataChanged(data, data);
      },

      ready: function() {
        this.calcBaseMetrics = function() {
          this.radians = Math.PI * 2 * this.$$('#radial-meter-bar').getAttribute('r');
          this.multiplier = this.radians / 360;
        };

        this.calcBaseMetrics();
        this.data = this.min;
      }
    });
  </script>
</dom-module>
